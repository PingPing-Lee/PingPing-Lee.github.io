(window.webpackJsonp=window.webpackJsonp||[]).push([[289],{565:function(t,s,a){"use strict";a.r(s);var n=a(14),p=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("如果你仔细阅读过构建后的代码，你就会发现存在⼤量闭包代码，我们来具体的分析一下，代码大致可以分为下图这几部分：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/webpack/bundle2.png",alt:"bundle"}})]),t._v(" "),s("ul",[s("li",[t._v("原项目中的 js 代码都被 webpack 转换后的模块会带上⼀层包裹，生成了一个 IIFE (匿名闭包)")]),t._v(" "),s("li",[t._v("modules 是⼀个数组，每⼀项是⼀个模块初始化函数")]),t._v(" "),s("li",[t._v("import 会被转换成 __webpack_require ⽤来加载模块，返回 module.exports")])]),t._v(" "),s("p",[t._v("这种⼤量作⽤域包裹代码，会导致包体积增⼤（模块越多越明显），同时运⾏代码时创建的函数作⽤域变多，内存开销也会变⼤")]),t._v(" "),s("p",[t._v("所以为了优化，引入了 "),s("strong",[t._v("scope hoisting")]),t._v("，其实现原理是将所有模块的代码按照引⽤顺序放在⼀个函数作⽤域⾥，然后适当的重命名⼀些变量以防⽌变量名冲突")]),t._v(" "),s("p",[t._v("和 "),s("strong",[t._v("tree shaking")]),t._v(" 一样，"),s("strong",[t._v("scope hoisting")]),t._v(" 在 webpack4 中也是默认⽀持的，在 mode 设置为 production 的情况下在打包时默认开启")]),t._v(" "),s("p",[t._v("也可以在 webpack.config.js 中的 plugins 中做如下的配置开启：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("plugins")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("webpack"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("optimize"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ModuleConcatenationPlugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("那么就来看一下开启之后打包构建的代码，和上面的做一下对比，如下：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/webpack/scopeHoisting.png",alt:"scopeHoisting"}})]),t._v(" "),s("p",[t._v("对比下来会发现通过 scope hoisting 可以减少函数声明代码和内存开销")])])}),[],!1,null,null,null);s.default=p.exports}}]);